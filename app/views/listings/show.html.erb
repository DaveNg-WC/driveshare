<div class="container" style="margin-top: 20px">

  <% if @listing.photos.attached? %>
    <% @listing.photos.each do |photo| %>
      <%= image_tag photo.variant(resize: '250x250'), class: "card-img-top" %>
    <% end %>
  <% end %>

  <h2><%= @listing.brand.to_s.capitalize %> <%= @listing.transmission.to_s.capitalize %></h2>
  <p><strong>Category:</strong> <%= @listing.category.to_s.capitalize %></p>
  <p><strong>Transmission:</strong> <%= @listing.transmission.to_s.capitalize %></p>
  <p><strong>Description:</strong> <%= @listing.description.capitalize %></p>
  <p><strong>Price:</strong> $<%= @listing.price %></p>
  <p><strong>Address:</strong> <%= @listing.address.capitalize %></p>
  <p><strong>User:</strong> <%= @listing.user.first_name %> <%= @listing.user.last_name %></p>


  <br>

  <%= link_to 'Edit', edit_listing_path(@listing) %> |
  <%= link_to 'Back', listings_path %>
  <p></p>
  <%# below is to test function of creating a new review for listing %>

  <% if @listing.user == current_user %>
    <%= link_to "Leave a Review", new_listing_review_path(@listing),
        class: "btn btn-primary",
        style: "color: white;"
    %>
  <% else %>
  <% end %>
  <p></p>

  <p><strong> Make a booking now: </strong></p>

    <%= form_with(model: @offer, url: listing_offers_path(@listing), local: true) do |form| %>
      <div class="form-group">
        <%= form.label :price %>
        <%= form.text_field :price, class: "form-control" %>
      </div>
      <div class="form-group">
        <%= form.label :start_date %>
        <%= form.date_field :start_date, class: "form-control" %>
      </div>
      <div class="form-group">
        <%= form.label :end_date %>
        <%= form.date_field :end_date, class: "form-control" %>
      </div>
      <br>
      <%= form.submit "Send Offer", class: "btn btn-primary" %>
    <% end %>

    <br>
    <p><strong>Reviews</strong></p>
    <% if @reviews.count == 0 %>
      <%= "There are currently no reviews for this listing!" %>
    <% else %>
      <ul class="list-group">
        <% @reviews.each do |review| %>
          <li class="list-group-item">
          <%= review.rating %> <%= review.description %>
          <% if review.user == current_user %>
            <%= link_to "Delete", review_path(review),
            class: "btn btn-warning",
            style: "color: white;",
            data: {turbo_method: :delete, turbo_confirm: "Are you sure to delete this review?"}
            %>
          <% end %>
          </li>
        <% end %>
      </ul>
    <% end %>
</div>
